<!DOCTYPE html>
<html lang='en'>
  <head>
    <title>isitfar</title>

    <link href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css" rel="stylesheet">

    <script>
      function checkDistance(event) {
        event.preventDefault();

        document.getElementById('output').innerHTML = 'Loading...';

        var from = event.currentTarget[0].value
        var max = event.currentTarget[1].value
        var to = event.currentTarget[2].value
        var url = encodeURI(`api/v1/handler?from=${from}&to=${to}`)

        var request = new XMLHttpRequest();
        request.open('GET', url, true);
        request.onload = function() {
          if (this.status == 200) {
            var distance = parseInt(request.responseText);

            if (distance <= max) {
              document.getElementById('output').innerHTML = 'Nice, you deliver to this location!';
            } else {
              document.getElementById('output').innerHTML = "You don't deliver this far!";
            }
          } else {
            document.getElementById('output').innerHTML = 'Error: ' + request.responseText;
          }
        };
        request.send();
      }
    </script>
  </head>
  <body>
    <div class='w-full max-w-xs'>
      <form class='bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4' onsubmit='checkDistance(event)'>
        <div class='mb-4'>
          <label class='block text-gray-700 text-sm font-bold mb-2' for='from'>Where are you?</label>
          <input class='shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline' type='text' id='from' name='from' placeholder='postcode' required>
        </div>
        <div class='mb-4'>
          <label class='block text-gray-700 text-sm font-bold mb-2' for='max'>How far will you go?</label>
          <input class='shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline' type='number' id='max' name='max' placeholder='metres' required>
        </div>
        <div class='mb-4'>
          <label class='block text-gray-700 text-sm font-bold mb-2' for='to'>Where is the dropoff?</label>
          <input class='shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline' type='text' id='to' name='to' placeholder='postcode' required>
        </div>
        <div class='flex items-center justify-between'>
          <button class='bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline' type='submit'>
            Submit
          </button>
        </div>
      </form>
      <p class='text-center text-gray-500 text-xs'>
        Source: <a href='https://www.getthedata.com/open-postcode-geo'>Office for National Statistics</a>
      </p>
      <p class='text-center text-gray-500 text-xs'>
        Open Government Licence v3.0
      </p>
    </div>

    <div id='output'></div>
  </body>
</html>
