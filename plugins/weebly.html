<script>
  function checkDistance(event) {
    event.preventDefault();
    document.getElementById('results').classList.remove('hidden');
    document.getElementById('output').innerHTML = 'Loading...';

    var from = 'W1J 7BX'
    var max = toMetres(5)
    var to = event.currentTarget[0].value
    var url = encodeURI(`https://worthatrip.com/api/v1/handler?from=${from}&to=${to}`)

    var request = new XMLHttpRequest();
    request.open('GET', url, true);
    request.onload = function() {
      if (this.status == 200) {
        var distance = parseInt(request.responseText);
        document.getElementById('results').classList.remove('hidden');

        if (distance <= max) {
          document.getElementById('output').innerHTML = 'Nice, you deliver to this location!';
        } else {
          document.getElementById('output').innerHTML = "You don't deliver this far!";
        }
      } else {
        document.getElementById('results').classList.add('hidden');

        if (request.responseText.includes('from')) {
          document.getElementById('from-error').innerHTML = request.responseText;
        } else if (request.responseText.includes('to')) {
          document.getElementById('to').classList.add('border-red-500');
          document.getElementById('to-error').innerHTML = request.responseText;
        }
      }
    };
    request.send();
  }

  function toMetres(miles) {
    return miles * 1609.344
  }
</script>

<form onsubmit='checkDistance(event)'>
  <div>
    <p id='from-error'></p>
  </div>
  <div>
    <label for='to'>What's your postcode?</label>
    <input type='text' id='to' name='to' placeholder='postcode' required>
    <p id='to-error'></p>
  </div>
  <div>
    <button type='submit'>
      Check if we deliver!
    </button>
  </div>
</form>

<div id='results'>
    <p id='output'></p>
</div>
